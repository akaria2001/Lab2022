---
- name: Setup Lab
  hosts: lab
  serial: 2
  become: true
  ignore_unreachable: true
  ignore_errors: true
  tasks:

    - name: Update OS Red Hat variants
      ansible.builtin.yum:
        name: "*"
        state: latest
      when: ansible_distribution == 'Rocky' or ansible_distribution == 'AlmaLinux' or ansible_distribution == 'CentOS' or ansible_distribution == 'OracleLinux'

    - name: Update apt cache
      apt:
        update_cache: yes
      when: ansible_facts['os_family'] == "Debian"

    - name: Upgrade all packages
      apt:
        upgrade: dist
      when: ansible_facts['os_family'] == "Debian"

    - name: Pause for 30 seconds
      ansible.builtin.pause:
        seconds: 30
      when: ansible_distribution == 'Rocky' or ansible_distribution == 'AlmaLinux' or ansible_distribution == 'CentOS' or ansible_distribution == 'OracleLinux'

    - name: Reboot
      ansible.builtin.reboot:
      when: >
        ansible_distribution == 'Rocky' or ansible_distribution == 'AlmaLinux' or ansible_distribution == 'CentOS' or
        ansible_distribution == 'Ubuntu' or ansible_distribution == 'Debian' or ansible_distribution == 'OracleLinux'

